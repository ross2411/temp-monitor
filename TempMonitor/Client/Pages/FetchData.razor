@page "/fetchdata"
@using TempMonitor.Shared
@inject HttpClient Http

<h1>Garden Office Temperatures</h1>
@if (temperatures == null)
{
    <p><em>Loading...</em></p>
}
else
{
    
    <RadzenDropDown AllowClear="true" TValue="string"
                    Data="@periods"
                    TextProperty="Name" ValueProperty="Value" Style="margin-bottom: 20px" Change="@(args => Change(args, "DropDown"))" />
    <label>Smooth <RadzenCheckBox @bind-Value="@smooth" Name="smooth"></RadzenCheckBox></label>
    <RadzenChart>
        <RadzenLineSeries Smooth="@smooth" Data="@temperatures" CategoryProperty="dateTime" Title="Inside Temp" ValueProperty="InsideTemp">
        </RadzenLineSeries>
        <RadzenLineSeries Smooth="@smooth" Data="@temperatures" CategoryProperty="Date" Title="Outside Temp" ValueProperty="OutsideTemp">
        </RadzenLineSeries>
        <RadzenCategoryAxis Padding="20" FormatString="{0:HH:MM}">
            <RadzenAxisTitle Text="Time"></RadzenAxisTitle>
        </RadzenCategoryAxis>
        <RadzenValueAxis Formatter="@FormatAsDegreesC">
            <RadzenGridLines Visible="true" />
            <RadzenAxisTitle Text="Temperature" />
        </RadzenValueAxis>
    </RadzenChart>
}



@code {
    private Temperature[] temperatures;
    private List<Period> periods = new List<Period>
        {
                new Period
                {
                    Name = "1 day",
                    Value = 1
                }
            };
    private bool smooth = true;

    protected override async Task OnInitializedAsync()
    {
        //TODO Swap out for SignalR
        temperatures = await Http.GetFromJsonAsync<Temperature[]>("weatherforecast/GetFiles?period=3");
    }

    string FormatAsDegreesC(object value)
    {
        return string.Format("{0}Â°C", value);
    }
    async Task Change(object value, string name)
    {
        temperatures = await Http.GetFromJsonAsync<Temperature[]>($"weatherforecast/GetFiles?period={value.ToString()}");
        StateHasChanged();
    }
}
